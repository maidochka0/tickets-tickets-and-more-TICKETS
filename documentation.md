# Документация по проекту "Система бронирования билетов"

## Описание структуры окончательной версии базы данных

### 1. Таблица `orders`
Эта таблица используется для хранения информации о заказах. Каждая запись содержит следующие поля:
- **id**: Уникальный идентификатор заказа (INT, AUTO_INCREMENT, PRIMARY KEY).
- **event_id**: Уникальный идентификатор события (INT, NOT NULL).
- **event_date**: Дата и время события (DATETIME, NOT NULL).
- **equal_price**: Общая стоимость заказа (INT, NOT NULL).
- **created**: Дата и время создания заказа (DATETIME, DEFAULT CURRENT_TIMESTAMP).

### 2. Таблица `ticket_types`
В этой таблице хранятся различные типы билетов, чтобы избежать дублирования информации и иметь возможность добавлять новые типы билетов, не затрагивая лишнее.
- **id**: Уникальный идентификатор типа билета (INT, AUTO_INCREMENT, PRIMARY KEY).
- **name**: Название типа билета (VARCHAR(120),UNIQUE NOT NULL).
- **price**: Цена за билет данного типа (INT, NOT NULL).

### 3. Таблица `tickets`
Эта таблица связывает заказы с конкретными билетами, позволяя проверять билеты по отдельности.
- **id**: Уникальный идентификатор билета (INT, AUTO_INCREMENT, PRIMARY KEY).
- **order_id**: Уникальный идентификатор заказа (INT, NOT NULL), внешний ключ, ссылающийся на `orders(id)`.
- **ticket_type_id**: Уникальный идентификатор типа билета (INT, NOT NULL), внешний ключ, ссылающийся на `ticket_types(id)`.
- **barcode**: Уникальный баркод для каждого билета (VARCHAR(120), UNIQUE, NOT NULL).

## Описание функций(версия первого задания)

### 1. `generateBarcode($length = 8)`
Эта функция генерирует случайный уникальный баркод заданной длины с ведущими нулями.

### 2. `bookOrder($event_id, $event_date, $ticket_adult_price, $ticket_adult_quantity, $ticket_kid_price, $ticket_kid_quantity, $pdo)`
Рекурсивная функция для бронирования заказа. Принимает данные о заказе, проверяет уникальность баркода, взаимодействует с мок API для подтверждения бронирования и сохрания информации о заказе в таблице `orders`. 

- **Параметры**:
  - `event_id`: ID события.
  - `event_date`: Дата и время события.
  - `ticket_adult_price`: Цена билета для взрослых.
  - `ticket_adult_quantity`: Количество билетов для взрослых.
  - `ticket_kid_price`: Цена билета для детей.
  - `ticket_kid_quantity`: Количество билетов для детей.
  - `pdo`: Соединение с базой данных.

### 3. Мок API функции:
- `mockApiBook(...)`: Условие выхода из рекурсии. Может возвращать успешный ответ или ошибку (например, дублирование баркода).
- `mockApiApprove($barcode)`: Процесс подтверждения заказа. Может возвращать различные ответы, включая успешное подтверждение и ошибки (например, отмена события).

## Схема нормализации таблиц
1. **Таблица `orders`** содержит основную информацию о заказах, содержащие общие данные по всем типам билетов.
2. **Таблица `ticket_types`** позволяет добавлять новый тип контента без изменения других таблиц, способствуя быстрому расширению системы.
3. **Таблица `tickets`** связывает заказы с конкретными типами билетов, позволяя иметь более детальную информацию о каждом билете в рамках одного заказа.

<hr>
спасибо за потраченное время